"use strict";function pageCheck(){var a=window.location.hash;console.log("page check"),"#/lobby"===a&&refreshList(),"#/game"===a&&Game.initialize(),"#/contact"===a&&console.log("Contact Page")}function refreshList(){console.log("refresh list"),$("#Game_List").empty(),loadList()}function loadList(){console.log("Load List of Games");var a="https://resplendent-inferno-1504.firebaseio.com";data.data=new Firebase(a),data.data.once("value",function(a){a=a.val(),data.snapshot=toArray(a),displayList(data.snapshot)})}function toArray(a){var b=[];for(var c in a)b.push(c);return b}function displayList(a){console.log("display list "+a.length);for(var b=0;b<a.length;b++){var c=document.getElementById("Game_List"),d=a[b].toString(),e='<div class="gameEntry">Name: '+a[b]+' - <a ng-href="#/game" href="#/game" onclick="Cookie.gameToken(\''+d+'\'), Game.pw_check()" class="btn btn-primary">Join Game</a></div>';c.innerHTML=c.innerHTML+e}}function createRoom(){var a=User.verifiedUser(),b=document.getElementById("New_room_name").value,c=document.getElementById("New_room_pw").value;if(a===!1){if(""===b)var d=!0;else var d=!1;if(console.log("New Room - "+b+" - "+d),-1===data.snapshot.indexOf(b)&&d===!1){var e="https://resplendent-inferno-1504.firebaseio.com/"+b;data.data=new Firebase(e),data.data.set({Password:c,Host:Cookie.getCookie("User")}),document.getElementById("New_room_name").value="",document.getElementById("New_room_pw").value="",refreshList()}else console.log("Room already exists / Blank Input")}else{var f=document.getElementById("create_button"),g='<button type="button" class="btn btn-warning" onclick="createRoom()" id="create_room">Login Required</button>';f.innerHTML=g}}function displayUser(){var a=Cookie.getCookie("User"),b=document.getElementById("user_cookie"),c="User: "+a;b.innerHTML="",b.innerHTML=b.innerHTML+c}angular.module("gameAngularAppApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/media",{templateUrl:"views/media.html",controller:"MediaCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).when("/lobby",{templateUrl:"views/lobby.html",controller:"LobbyCtrl"}).when("/game",{templateUrl:"views/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/"})}]);var data={};$("#pw_recover").popover({trigger:"hover"}),$("#createUser").popover({trigger:"hover"}),$("#email_icon").popover({trigger:"hover"}),$(document).ready(function(){console.log("loaded page"),Cookie.checkCookie(),displayUser(),pageCheck()}),$(window).bind("hashchange",function(){pageCheck()});var Cookie={};Cookie.checkCookie=function(){"null"===Cookie.getCookie("User")||void 0===Cookie.getCookie("User")||null===Cookie.getCookie("User")?Cookie.generateName():console.log("ID already set at = "+Cookie.getCookie("User"))},Cookie.generateName=function(){if(User.authData){console.log("if");var a=User.authData.password.email;a=a.replace(/([.*+?^${}()|\[\]\/\\])/g,""),a=a.replace(/(@)/g,"_"),a=a.replace(/(com)/g,"");var b="User="+a}else{console.log("else");var b=Math.floor(1e3*Math.random()+1);b="User="+b}document.cookie=b},Cookie.getCookie=function(a){var b=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)");return b?b[2]:null},Cookie.gameToken=function(a){console.log("generate ID cookie"+a),"null"===Cookie.getCookie("Game_id")||void 0===Cookie.getCookie("Game_id")||null===Cookie.getCookie("Game_id")?Cookie.makeCookie("Game_ID",a):console.log("ID already set at = "+Cookie.getCookie("User"))},Cookie.deleteCookie=function(a){document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},Cookie.makeCookie=function(a,b){var c=a+"="+b;document.cookie=c};var User={};User.createUser=function(){console.log("create account");var a=new Firebase("https://resplendent-inferno-1504.firebaseio.com"),b=document.getElementById("user_email").value,c=document.getElementById("user_pw").value;a.createUser({email:b,password:c},function(a){console.log(null===a?"User created successfully":'Error creating user:", error')})},User.loginUser=function(){var a=new Firebase("https://resplendent-inferno-1504.firebaseio.com"),b=document.getElementById("user_email").value,c=document.getElementById("user_pw").value;a.authWithPassword({email:b,password:c},function(a,b){a?console.log("Login Failed!",a):(console.log("Authenticated successfully with payload:",b),User.authData=b,Cookie.deleteCookie("User"),Cookie.generateName(),displayUser(),document.getElementById("user_email").value=""),document.getElementById("user_pw").value=""})},User.recoverEmail=function(){console.log("Recovery Email");var a=new Firebase("https://resplendent-inferno-1504.firebaseio.com"),b=document.getElementById("user_email").value;a.resetPassword({email:b},function(a){null===a?console.log("Password reset email sent successfully"):console.log("Error sending password reset email:",a)})},User.verifiedUser=function(){var a=/^\d+$/.test(Cookie.getCookie("User"));return a},angular.module("gameAngularAppApp").controller("HomeCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("gameAngularAppApp").controller("LobbyCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("gameAngularAppApp").controller("MediaCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("gameAngularAppApp").controller("ContactCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("gameAngularAppApp").controller("GameCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);var Game=Game||{};Game.initialize=function(){Game.height=20,Game.width=45,Game.scale=20,Game.sidebar=200,Game.fps=10,Game.token=Cookie.getCookie("Game_ID"),Game.user_token=Cookie.getCookie("User"),console.log("Game Id - "+Game.token+" - "+Game.user_token);var a="https://resplendent-inferno-1504.firebaseio.com/"+Game.token;Game.load_map_tiles("test_1"),Game.data=new Firebase(a),Game.firebase_push()},Game.firebase_push=function(){Game.data.once("value",function(a){Game.snapshot=a.val();var b=Game.data.child("map");b.set({map_data:Game.map}),Game.stats={},Game.stats.health=100,Game.stats.mana=100,Game.draw_map(Game.snapshot.map.map_data),Game.load_player(Game.user_token)}),Game.data.on("value",function(a){Game.snapshot=a.val();var b=Game.snapshot.users["user_"+Game.user_token];Game.draw_local_character(b),Game.refresh(b),Game.load_firebase_char(Game.snapshot.users)})};var Game=Game||{};Game.load_player=function(a){var b=Game.data.child("users");Game.updateObject={},Game.updateObject["user_"+a]=Game.starting_position(),b.update(Game.updateObject)},Game.starting_position=function(){return{current_pos:Game.map[0]}},Game.draw_local_character=function(a){Game.collision=!0,Crafty.sprite("./images/Char_1.38f3cfb6.png",{player:[0,0,Game.scale,Game.scale]}),Game.character=Crafty.e("Collision, Canvas, Color, player").attr({x:a.current_pos[0]*Game.scale,y:a.current_pos[1]*Game.scale,w:Game.scale,h:Game.scale}).checkHits("wall").bind("EnterFrame",Game.enter_frame).bind("ExitFrame",Game.exit_frame).bind("HitOn",Game.hit_wall).bind("KeyDown",Game.key_bindings)},Game.enter_frame=function(){},Game.exit_frame=function(){Game.update_firebase()},Game.hit_wall=function(){Game.collision=!1,console.log("Collision chk = false"),Game.move_resolve()},Game.update_firebase=function(){var a=Game.data.child("users");Game.updateObject["user_"+Game.user_token]={current_pos:[Game.character.x/Game.scale,Game.character.y/Game.scale,Game.stats.health]},a.update(Game.updateObject),Game.refresh_stats()},Game.move_test=function(){1===Game.move?Game.character.x=Game.character.x-Game.scale:2===Game.move?Game.character.x=Game.character.x+Game.scale:3===Game.move?Game.character.y=Game.character.y-Game.scale:4===Game.move&&(Game.character.y=Game.character.y+Game.scale)},Game.move_resolve=function(){1===Game.move&&Game.collision===!1&&(Game.character.x=Game.character.x+Game.scale,Game.collision=!0),2===Game.move&&Game.collision===!1&&(Game.character.x=Game.character.x-Game.scale,Game.collision=!0),3===Game.move&&Game.collision===!1&&(Game.character.y=Game.character.y+Game.scale,Game.collision=!0),4===Game.move&&Game.collision===!1&&(Game.character.y=Game.character.y-Game.scale,Game.collision=!0)},Game.key_bindings=function(a){a.key==Crafty.keys.LEFT_ARROW?Game.move=1:a.key==Crafty.keys.RIGHT_ARROW?Game.move=2:a.key==Crafty.keys.UP_ARROW?Game.move=3:a.key==Crafty.keys.DOWN_ARROW?Game.move=4:a.key==Crafty.keys.SPACE&&(Game.move=5,Game.stats.health=Game.stats.health-5,console.log(Game.stats.health)),Game.move_test()},Game.load_firebase_char=function(a){var b=[],c=Object.keys(a).length,d="user_"+Game.user_token;for(var e in a)b.push(e);Game.firebase_char=[];for(var f=0;c>f;f++)b[f]!=d&&"map"!=b[f]&&Game.firebase_char.push(b[f]);Game.draw_firebase_char(a)},Game.draw_firebase_char=function(a){for(var b=0;b<Game.firebase_char.length;b++){console.log("creating other player "+b+1);var c=a[Game.firebase_char[b]],d=Game.firebase_char;console.log(c),d[c]=Crafty.e("Canvas, Color, player").attr({x:c.current_pos[0]*Game.scale,y:c.current_pos[1]*Game.scale,w:Game.scale,h:Game.scale}),Game.health_bars(1,c.current_pos[0]*Game.scale,c.current_pos[1]*Game.scale,c.current_pos[2])}},Game.draw_stats=function(){Crafty.e("2D, Canvas, Color, stats").color("white").attr({x:50,y:300,w:100,h:Game.scale}),Crafty.e("2D, Canvas, Color, stats").color("red").attr({x:50,y:300,w:Game.stats.health,h:Game.scale}),Crafty.e("2D, Canvas, Text, stats").attr({x:50,y:285}).text("Health")},Game.health_bars=function(a,b,c,d){Crafty.e("2D, Canvas, Color, health_token, Token").color("white").attr({x:b+5,y:c-1,w:Game.scale-5,h:3});var e=d/100;Crafty.e("2D, Canvas, Color, health_token, Token").color("red").attr({x:b+5,y:c-1,w:(Game.scale-5)*e,h:3}),Crafty.sprite("./images/Shield_token.64d2ec9b.png",{Shield_token:[10*a,0,10,10]}),Crafty.e("Canvas, Color, Shield_token, Token").attr({x:b-3,y:c-2,w:Game.scale/3,h:Game.scale/3})},Game.refresh_stats=function(){Crafty("stats").each(function(){this.destroy()}),Game.draw_stats()},Game.refresh=function(a){Crafty("player").each(function(){this.destroy()}),Crafty("Token").each(function(){this.destroy()}),Game.draw_local_character(a),Game.health_bars(0,a.current_pos[0]*Game.scale,a.current_pos[1]*Game.scale,Game.stats.health)};var Game=Game||{};Game.refresh_map=function(){Crafty("tile").each(function(){this.destroy()}),Game.draw_map(Game.snapshot.map.map_data)},Game.draw_map=function(a){Crafty.init(Game.width*Game.scale,Game.height*Game.scale,document.getElementById("game")),Game.map_check(a),Game.draw_sel_col(a),Game.draw_sidebar()},Game.draw_sidebar=function(){for(var a=0;a<Game.height*Game.scale;a++)for(var b=0;b<Game.sidebar/Game.scale;b++){var c=0;c=9===b||0===b?1:0===a||19===a?2:3,(0===b&&0===a||9===b&&19===a||0===b&&19===a||9===b&&0===a)&&(c=0),Game.draw_sidebar_corner(b*Game.scale,a*Game.scale,c)}},Game.draw_sel_col=function(a){for(var b=0;b<Game.height;b++){var c=a[b+1];Game.draw_row(c,b)}},Game.map_check=function(a){var b=Game.height-a.length;console.log("map height "+a.length+" - "+b);for(var c=0;b>c;c++)a.push([])},Game.draw_row=function(a,b){for(var c,d=0;d<Game.width;d++)c=a[d],1===c?Game.draw_map_wall(d*Game.scale+Game.sidebar,b*Game.scale):2===c?Game.draw_map_floor(d*Game.scale+Game.sidebar,b*Game.scale):3===c?Game.draw_map_door(d*Game.scale+Game.sidebar,b*Game.scale):Game.draw_map_void(d*Game.scale+Game.sidebar,b*Game.scale)},Game.draw_map_void=function(a,b){Crafty.e("2D, Canvas, Color, tile").color("black").attr({x:a,y:b,w:Game.scale,h:Game.scale})},Game.draw_map_floor=function(a,b){var c=Math.floor(3*Math.random());Crafty.sprite("./images/Floor_1.14608657.png",{floor:[c*Game.scale,0,Game.scale,Game.scale]}),Crafty.e("2D, Canvas, Color, floor, tile").color("grey").attr({x:a,y:b,w:Game.scale,h:Game.scale})},Game.draw_sidebar_corner=function(a,b,c){Crafty.sprite("./images/Sidebar_1.da9d308b.png",{sidebar:[c*Game.scale,0,Game.scale,Game.scale]}),Crafty.e("2D, Canvas, Color, sidebar").color("brown").attr({x:a,y:b,w:Game.scale,h:Game.scale})},Game.draw_map_wall=function(a,b){Crafty.sprite("./images/Wall_1.74c8aec9.png",{wall:[0,0,Game.scale,Game.scale]}),Crafty.e("2D, Canvas, Color, wall, tile").color("brown").attr({x:a,y:b,w:Game.scale,h:Game.scale})},Game.draw_map_door=function(a,b){Crafty.sprite("./images/Door.0a3acd2e.png",{wall:[0,0,Game.scale,Game.scale]}),Crafty.e("2D, Canvas, Color, wall, tile").color("brown").attr({x:a,y:b,w:Game.scale,h:Game.scale})};var Game=Game||{};Game.load_map_tiles=function(a){"test_1"===a&&(Game.map=[[12,2],[1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,1,1,1,1,1,2,2,2,2,1,0,1,1,1,1,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,2,2,2,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,0,0,0,1,2,2,2,2,1,1,1,2,2,2,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,1,2,2,2,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,2,2,2,2,1,0,1,2,2,2,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,1,1,2,2,2,2,1,0,1,1,1,1,1,0,1,1,1,1,2,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,1,1,1,1,2,1,1,0,0,0,0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,0],[1,2,2,2,2,2,2,1,0,0,1,2,1,0,0,0,0,0,1,1,1,1,1,1,1,2,1,0,0,0,0,0,0,0],[1,2,2,2,2,2,2,1,1,1,1,2,1,1,1,1,1,0,1,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,1,1,1,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,1,0,1,2,2,2,2,2,2,2,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,0,1,1,1,2,1,1,1,1,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[0,0,0,0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]])};